# DC License Bot

[![Rust](https://img.shields.io/badge/rust-%23000000.svg?style=for-the-badge&logo=rust&logoColor=white)](https://www.rust-lang.org/)
[![Discord](https://img.shields.io/badge/Discord-%235865F2.svg?style=for-the-badge&logo=discord&logoColor=white)](https://discord.com/)

ä¸€ä¸ªç”¨ Rust æ„å»ºçš„ Discord æœºå™¨äººï¼Œä¸“é—¨ç”¨äºåˆ›ä½œè€…ä½œå“çš„è®¸å¯åè®®ç®¡ç†ã€‚æœºå™¨äººæä¾›å®Œæ•´çš„è®¸å¯åè®®å£°æ˜ã€ç®¡ç†å’Œè‡ªåŠ¨å‘å¸ƒåŠŸèƒ½ï¼Œéµå¾ª**åå•†ä¸šåŒ–**åŸåˆ™ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ“ è®¸å¯åè®®ç®¡ç†
- **åˆ›å»ºè‡ªå®šä¹‰åè®®** - ç”¨æˆ·å¯åˆ›å»ºä¸ªæ€§åŒ–çš„è®¸å¯åè®®ï¼ˆé™åˆ¶5ä¸ªï¼‰
- **åè®®ç®¡ç†é¢æ¿** - æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤å·²åˆ›å»ºçš„åè®®
- **æ™ºèƒ½åè®®å‘å¸ƒ** - åœ¨ Discord å¸–å­ä¸­åº”ç”¨è®¸å¯åè®®
- **æƒé™éªŒè¯** - ç¡®ä¿åªæœ‰ä½œå“ä½œè€…å¯ä»¥æ·»åŠ åè®®

### âš¡ è‡ªåŠ¨åŒ–åŠŸèƒ½
- **è‡ªåŠ¨å‘å¸ƒè®¾ç½®** - åœ¨æŒ‡å®šè®ºå›é¢‘é“å‘å¸–æ—¶è‡ªåŠ¨é™„åŠ è®¸å¯åè®®
- **é»˜è®¤åè®®é…ç½®** - è®¾ç½®å¸¸ç”¨çš„é»˜è®¤è®¸å¯åè®®
- **åè®®æ›´æ–°æ›¿æ¢** - è‡ªåŠ¨åºŸå¼ƒæ—§åè®®å¹¶å‘å¸ƒæ–°ç‰ˆæœ¬
- **å¤‡ä»½æƒé™é€šçŸ¥** - é›†æˆå¤–éƒ¨å¤‡ä»½æœåŠ¡ï¼Œæƒé™å˜æ›´æ—¶è‡ªåŠ¨é€šçŸ¥

### ğŸ›¡ï¸ ç®¡ç†å‘˜åŠŸèƒ½
- **ç³»ç»Ÿä¿¡æ¯ç›‘æ§** - æŸ¥çœ‹æœºå™¨äººè¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
- **çƒ­é‡è½½ç³»ç»Ÿæˆæƒ** - æ— éœ€é‡å¯å³å¯æ›´æ–°ç³»ç»Ÿè®¸å¯é…ç½®
- **æƒé™ç®¡ç†** - åŸºäºé…ç½®æ–‡ä»¶çš„çµæ´»æƒé™æ§åˆ¶

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åˆ†å±‚æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Commands Layer               â”‚  â† Poise æ–œæ å‘½ä»¤æ¡†æ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Handlers Layer               â”‚  â† Discord äº‹ä»¶å¤„ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚            Services Layer               â”‚  â† ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Database Layer               â”‚  â† Sea-ORM + SQLite
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œç©ºé—´ç»“æ„
```
dc-license-bot/
â”œâ”€â”€ src/                    # ä¸»åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ commands/           # æ–œæ å‘½ä»¤å®ç°
â”‚   â”‚   â”œâ”€â”€ license/        # è®¸å¯åè®®ç›¸å…³å‘½ä»¤
â”‚   â”‚   â””â”€â”€ system.rs       # ç³»ç»Ÿç®¡ç†å‘½ä»¤
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ license/        # è®¸å¯ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ notification_service.rs  # å¤–éƒ¨é€šçŸ¥
â”‚   â”‚   â”œâ”€â”€ system_license.rs       # ç³»ç»Ÿè®¸å¯ç¼“å­˜
â”‚   â”‚   â””â”€â”€ user_settings.rs        # ç”¨æˆ·è®¾ç½®
â”‚   â”œâ”€â”€ handlers/           # Discord äº‹ä»¶å¤„ç†
â”‚   â”œâ”€â”€ database.rs         # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â””â”€â”€ main.rs            # åº”ç”¨å…¥å£
â”œâ”€â”€ entities/              # æ•°æ®åº“å®ä½“ï¼ˆå·¥ä½œç©ºé—´æˆå‘˜ï¼‰
â”œâ”€â”€ migration/             # æ•°æ®åº“è¿ç§»ï¼ˆå·¥ä½œç©ºé—´æˆå‘˜ï¼‰
â””â”€â”€ config.example.toml    # é…ç½®æ¨¡æ¿
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **ğŸ¦€ Rust** - ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œé«˜æ€§èƒ½ + å†…å­˜å®‰å…¨
- **ğŸ”Œ Serenity + Poise** - Discord API å°è£… + å‘½ä»¤æ¡†æ¶  
- **ğŸ—„ï¸ Sea-ORM** - ç°ä»£å¼‚æ­¥ ORMï¼Œæ”¯æŒè¿ç§»
- **ğŸ“Š SQLite** - åµŒå…¥å¼æ•°æ®åº“ï¼Œç®€åŒ–éƒ¨ç½²
- **âš™ï¸ Figment** - çµæ´»çš„é…ç½®ç®¡ç†ï¼ˆTOML + ç¯å¢ƒå˜é‡ï¼‰
- **ğŸ”„ Tokio** - å¼‚æ­¥è¿è¡Œæ—¶
- **ğŸ’¾ Jemalloc** - é«˜æ€§èƒ½å†…å­˜åˆ†é…å™¨ï¼ˆå‡å°‘60-80%å†…å­˜ä½¿ç”¨ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Rust 1.70+ 
- Discord åº”ç”¨ç¨‹åºå’Œæœºå™¨äººä»¤ç‰Œ

### å®‰è£…ä¸é…ç½®

1. **å…‹éš†ä»“åº“**
   ```bash
   git clone https://github.com/Opizontas-Studio/dc-license-bot.git
   cd dc-license-bot
   ```

2. **é…ç½®æœºå™¨äºº**
   ```bash
   cp config.example.toml config.toml
   # ç¼–è¾‘ config.tomlï¼Œå¡«å…¥ä½ çš„ Discord æœºå™¨äººä»¤ç‰Œ
   ```

3. **åˆå§‹åŒ–æ•°æ®åº“**
   ```bash
   cargo run --bin migration
   ```

4. **è¿è¡Œæœºå™¨äºº**
   ```bash
   cargo run -- -c config.toml -d ./data/bot.db -l ./system_licenses.json
   ```

### é…ç½®æ–‡ä»¶ç¤ºä¾‹
```toml
# Discord Bot Configuration 
# ä½¿ç”¨å‰è¯·å¤åˆ¶ä¸º "config.toml" å¹¶å¡«å…¥ä¿¡æ¯ã€‚

# [æ ¸å¿ƒé…ç½®]
token = "YOUR_DISCORD_BOT_TOKEN_HERE"
time_offset = 7200
# [å®‰å…¨ä¸æƒé™]

# æ‹¥æœ‰ç‰¹æ®Šæƒé™çš„ç”¨æˆ·IDåˆ—è¡¨ã€‚
extra_admins_ids = [
    # 80181316945921,123456789876
]
admin_role_ids = [

]


# æ˜¯å¦å¯ç”¨ä¸å¤‡ä»½Botçš„åŒæ­¥åŠŸèƒ½
backup_enabled = false
# å¤‡ä»½Botçš„æ¥æ”¶ç«¯ç‚¹ URL
endpoint = "http://127.0.0.1:8199"
```

## ğŸ“‹ å‘½ä»¤åˆ—è¡¨

### ç”¨æˆ·å‘½ä»¤
| å‘½ä»¤ | ä¸­æ–‡å | æè¿° |
|------|--------|------|
| `/create_license` | `/åˆ›å»ºåè®®` | åˆ›å»ºè‡ªå®šä¹‰è®¸å¯åè®® |
| `/license_manager` | `/åè®®ç®¡ç†` | ç®¡ç†ç°æœ‰çš„è®¸å¯åè®® |
| `/publish_license` | `/å‘å¸ƒåè®®` | åœ¨å¸–å­ä¸­å‘å¸ƒè®¸å¯åè®® |
| `/auto_publish_settings` | `/è‡ªåŠ¨å‘å¸ƒè®¾ç½®` | é…ç½®è‡ªåŠ¨å‘å¸ƒåŠŸèƒ½ |
| `/create_license_interactive` | `/åˆ›å»ºåè®®é¢æ¿` | ä½¿ç”¨äº¤äº’å¼é¢æ¿åˆ›å»ºæ–°åè®® |

### ç®¡ç†å‘˜å‘½ä»¤
| å‘½ä»¤ | ä¸­æ–‡å | æè¿° |
|------|--------|------|
| `/system_info` | `/ç³»ç»Ÿä¿¡æ¯` | æŸ¥çœ‹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ |
| `/reload_licenses` | `/é‡è½½ç³»ç»Ÿæˆæƒ` | çƒ­é‡è½½ç³»ç»Ÿè®¸å¯é…ç½® |

## ğŸ—ƒï¸ æ•°æ®åº“ç»“æ„

### ç”¨æˆ·è®¸å¯è¡¨ (`user_licenses`)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `id` | INTEGER | è®¸å¯IDï¼ˆä¸»é”®ï¼‰ |
| `user_id` | BIGINT | ç”¨æˆ·Discord ID |
| `license_name` | TEXT | è®¸å¯åè®®åç§° |
| `allow_redistribution` | BOOLEAN | æ˜¯å¦å…è®¸äºŒæ¬¡ä¼ æ’­ |
| `allow_modification` | BOOLEAN | æ˜¯å¦å…è®¸äºŒæ¬¡æ”¹ç¼– |
| `restrictions_note` | TEXT | é™åˆ¶è¯´æ˜ï¼ˆå¯é€‰ï¼‰ |
| `allow_backup` | BOOLEAN | æ˜¯å¦å…è®¸å¤‡ä»½ |
| `usage_count` | INTEGER | ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡ |
| `created_at` | DATETIME | åˆ›å»ºæ—¶é—´ |

### ç”¨æˆ·è®¾ç½®è¡¨ (`user_settings`)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `user_id` | BIGINT | ç”¨æˆ·Discord IDï¼ˆä¸»é”®ï¼‰ |
| `auto_publish_enabled` | BOOLEAN | æ˜¯å¦å¯ç”¨è‡ªåŠ¨å‘å¸ƒ |
| `skip_auto_publish_confirmation` | BOOLEAN | æ˜¯å¦è·³è¿‡è‡ªåŠ¨å‘å¸ƒçš„ç¡®è®¤æ­¥éª¤ |
| `default_user_license_id` | INTEGER | é»˜è®¤ç”¨æˆ·è®¸å¯IDï¼ˆå¯é€‰ï¼‰ |
| `default_system_license_name` | TEXT | é»˜è®¤ç³»ç»Ÿè®¸å¯åç§°ï¼ˆå¯é€‰ï¼‰ |
| `default_system_license_backup` | BOOLEAN | é»˜è®¤ç³»ç»Ÿè®¸å¯çš„å¤‡ä»½è®¾ç½®ï¼ˆå¯é€‰ï¼‰ |

### å·²å‘å¸ƒå¸–å­è¡¨ (`published_posts`)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `thread_id` | BIGINT | å¸–å­çº¿ç¨‹IDï¼ˆä¸»é”®ï¼‰ |
| `message_id` | BIGINT | åè®®æ¶ˆæ¯ID |
| `user_id` | BIGINT | å‘å¸ƒè€…ç”¨æˆ·ID |
| `backup_allowed` | BOOLEAN | å½“å‰å¤‡ä»½æƒé™çŠ¶æ€ |
| `updated_at` | DATETIME | æœ€åæ›´æ–°æ—¶é—´ |

## ğŸ”§ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘
```bash
# æ£€æŸ¥ä»£ç 
cargo check

# è¿è¡Œæµ‹è¯•
cargo test

# ä»£ç æ ¼å¼åŒ–
cargo fmt

# ä»£ç æ£€æŸ¥
cargo clippy
```

### æ•°æ®åº“æ“ä½œ
```bash
# åˆ›å»ºæ–°çš„è¿ç§»
cargo run --bin migration generate <migration_name>

# åº”ç”¨è¿ç§»
cargo run --bin migration

# é‡æ–°ç”Ÿæˆå®ä½“
sea-orm-cli generate entity \
    --database-url "sqlite://./data/bot.db" \
    --output-dir entities/src/entities
```

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t dc-license-bot:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  -v $(pwd)/config.toml:/app/config.toml \
  -v $(pwd)/data:/app/data \
  dc-license-bot:latest
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **æƒé™éªŒè¯** - åªæœ‰å¸–å­ä½œè€…å¯ä»¥æ·»åŠ è®¸å¯åè®®
- **ç®¡ç†å‘˜æ§åˆ¶** - åŸºäºé…ç½®çš„ç®¡ç†å‘˜æƒé™ç®¡ç†
- **é€Ÿç‡é™åˆ¶** - é˜²æ­¢å‘½ä»¤æ»¥ç”¨çš„å†·å´æœºåˆ¶
- **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤** - é…ç½®æ–‡ä»¶ä¸åŒ…å«åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **Jemalloc å†…å­˜åˆ†é…å™¨** - æ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ï¼ˆ60-80%ä¼˜åŒ–ï¼‰
- **ç³»ç»Ÿè®¸å¯ç¼“å­˜** - å†…å­˜ç¼“å­˜æé«˜å“åº”é€Ÿåº¦
- **å¼‚æ­¥æ¶æ„** - åŸºäº Tokio çš„é«˜å¹¶å‘å¤„ç†
- **æ•°æ®åº“è¿æ¥æ± ** - ä¼˜åŒ–æ•°æ®åº“è®¿é—®æ€§èƒ½

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨åå•†ä¸šåŒ–åŸåˆ™ã€‚è¯¦è§é¡¹ç›®å†…çš„è®¸å¯åè®®å£°æ˜ã€‚

## ğŸ™ è‡´è°¢

- [Serenity](https://github.com/serenity-rs/serenity) - Discord API åº“
- [Poise](https://github.com/serenity-rs/poise) - Discord å‘½ä»¤æ¡†æ¶
- [Sea-ORM](https://github.com/SeaQL/sea-orm) - Rust ORM æ¡†æ¶

---

**DC License Bot** - è®©åˆ›ä½œè€…çš„æƒåˆ©å¾—åˆ°å°Šé‡å’Œä¿æŠ¤ ğŸ›¡ï¸